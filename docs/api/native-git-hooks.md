# Native Git Hooks - PIO Manager Pro

<!-- [AI-Generated-Copilot] - Documentation for native Git hooks setup -->

This document explains the native Git hooks that have been set up in PIO Manager Pro alongside the existing Husky setup.

## Overview

The project now has native Git hooks installed in `.git/hooks/` that work independently of Husky. These hooks provide the same functionality as the Husky hooks but use Git's built-in hook system directly.

## Native Hooks vs Husky

### Benefits of Native Hooks

- ‚úÖ No external dependencies - uses Git's built-in system
- ‚úÖ Always available in any Git environment
- ‚úÖ Better performance - no tool overhead
- ‚úÖ Works with any Git client or IDE

### Drawbacks Compared to Husky

- ‚ùå **Platform compatibility issues** - shell scripts may not work consistently across Windows/Mac/Linux
- ‚ùå **Manual setup required** - need to copy hooks manually to new clones
- ‚ùå **No built-in sharing** - `.git/hooks/` is not tracked in version control
- ‚ùå **Less user-friendly** - harder to manage and update across team

**üìö Learn More About Git Hooks:** [Official Git Hooks Documentation](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)

## Installed Hooks

### Pre-commit Hook (`.git/hooks/pre-commit`)

**What it does:**

- Runs `lint-staged` for code quality checks
- Scans for AI-generated content comments in staged files
- **Checks AI-restricted files** and prompts user for confirmation
- Sets flag for commit-msg hook when AI content is detected
- Provides feedback about detected AI content

**AI Content Detection:**
Scans for these patterns in staged files:

- `[AI-Generated-Copilot]` - GitHub Copilot
- `[AI-Generated-Claude]` - Anthropic Claude
- `[AI-Generated-ChatGPT]` - OpenAI ChatGPT
- `[AI-Generated-Gemini]` - Google Gemini
- `[AI-Generated-Other]` - Other AI tools

**AI Restriction Enforcement:**

- Checks if AI-modified files match patterns in `.ai-restricted-files`
- Prompts user with options when AI touches restricted files:
  - **Continue** - Proceed with commit (logs override decision)
  - **Abort** - Stop commit to review changes
  - **Remove** - Remove AI comments (not yet implemented)
- Logs all override decisions to `.ai-restriction-log` for audit

### Commit-msg Hook (`.git/hooks/commit-msg`)

**For AI-assisted commits:**

- Validates `[AI-ASSISTED]` format
- Ensures required fields are present:
  - `Generated by: [AI Tool]`
  - `Reviewed by: [Developer Name]`
  - `Scope: [Component/Feature]`
- Logs AI commits to `.ai-commit-log` for audit trail

**For regular commits:**

- Validates conventional commit format
- Ensures proper commit types (feat, fix, docs, style, refactor, test, chore)

### Pre-push Hook (`.git/hooks/pre-push`)

**What it does:**

- Runs TypeScript type checking (`npx tsc --noEmit`)
- Executes test suite (if test script exists)
- Performs production build verification (`npm run build`)
- Prevents push if any check fails

## AI Commit Format

When AI-generated content is detected, use this commit format:

```
[AI-ASSISTED] feat(dashboard): add PIO filter component

Generated by: GitHub Copilot
Reviewed by: John Doe
Scope: Dashboard Components

Added CategoryFilter component with multi-select functionality
and URL state management for bookmarking filtered views.
```

## AI-Restricted Files

### Configuration

Create a `.ai-restricted-files` file in your project root to define files that AI tools should not modify:

```bash
# Security-sensitive files
**/security/**
**/auth/**
**/.env*

# Critical configuration files
**/package.json
**/tsconfig.json

# Example patterns
ai-restricted-file.txt
**/critical-component.tsx
**/payment-processor.ts
```

### Behavior

When AI touches a restricted file:

1. **Detection** - Pre-commit hook identifies the violation
2. **Warning** - User is presented with a clear warning
3. **Options** - User can continue, abort, or remove AI comments
4. **Logging** - Override decisions are logged to `.ai-restriction-log`

### Example Restriction Violation

```bash
‚ö†Ô∏è  üö® AI RESTRICTION VIOLATION DETECTED üö®

ü§ñ AI tools have modified the following RESTRICTED files:
  ‚ùå ai-restricted-file.txt

These files are marked as AI-restricted in .ai-restricted-files
What would you like to do?
  [c] Continue with commit (I take responsibility)
  [a] Abort commit and review changes
  [r] Remove AI comments and continue

Choose [c/a/r]:
```

## Setting Up in Other Projects

To copy these hooks to another project:

### 1. Copy Hook Files

Copy the hook files from this project to your target project:

```bash
# Create hooks directory if it doesn't exist
mkdir -p /path/to/your/project/.git/hooks

# Copy the hooks
cp .git/hooks/pre-commit /path/to/your/project/.git/hooks/
cp .git/hooks/commit-msg /path/to/your/project/.git/hooks/
cp .git/hooks/pre-push /path/to/your/project/.git/hooks/
```

### 2. Make Hooks Executable (Linux/Mac)

```bash
chmod +x /path/to/your/project/.git/hooks/pre-commit
chmod +x /path/to/your/project/.git/hooks/commit-msg
chmod +x /path/to/your/project/.git/hooks/pre-push
```

### 3. Ensure Dependencies

Make sure your target project has:

- `lint-staged` configured in `package.json`
- `npx` available for running commands
- `npm run build` script for build checking
- TypeScript configured (for type checking)

### 4. Customize for Your Project

You may need to adjust the hooks for your specific project:

**Pre-commit hook:**

- Modify lint-staged command if different
- Adjust AI content detection patterns if needed

**Commit-msg hook:**

- Update project name in `.ai-commit-log` header
- Modify conventional commit types if using different ones

**Pre-push hook:**

- Change `npm run build` to your build command
- Modify test command if using different test runner
- Adjust TypeScript checking if using different setup

## Hook Behavior Examples

### Normal Commit Flow

```bash
git add file.ts
git commit -m "feat(api): add user validation"
# ‚úÖ Conventional commit format validated
```

### AI-Assisted Commit Flow

```bash
# Add file with AI-generated content
git add src/utils/helpers.ts  # Contains [AI-Generated-Copilot] comment

git commit -m "[AI-ASSISTED] feat(utils): add helper functions

Generated by: GitHub Copilot
Reviewed by: John Doe
Scope: Utility Functions"

# ü§ñ Validating AI-assisted commit message...
# ‚úÖ AI-assisted commit message validated
```

### Pre-push Flow

```bash
git push origin feature-branch

# üîç Running TypeScript type check...
# ‚úÖ TypeScript type checking passed
# ‚ö†Ô∏è  No test script found, skipping tests
# üèóÔ∏è  Running production build check...
# ‚úÖ Production build successful
# üöÄ All pre-push checks passed!
```

## Audit Trail

AI-assisted commits are logged to `.ai-commit-log`:

```
# AI Commit Log - PIO Manager Pro
# Format: Timestamp | Commit Hash | Commit Title | AI Tool | Developer

2024-01-15 10:30:45 | abc123 | [AI-ASSISTED] feat(utils): add validation helpers | GitHub Copilot | john.doe
2024-01-15 14:22:18 | def456 | [AI-ASSISTED] docs(api): update endpoint documentation | Claude | jane.smith
```

## Troubleshooting

### Hooks Not Running

1. **Check if hooks exist:**

   ```bash
   ls -la .git/hooks/
   ```

2. **Check Git hooks path configuration:**

   ```bash
   git config core.hooksPath
   ```

   If this returns `.husky/_` or any path other than empty, reset it:

   ```bash
   git config --unset core.hooksPath
   ```

3. **Make sure they're executable (Linux/Mac):**

   ```bash
   chmod +x .git/hooks/pre-commit
   chmod +x .git/hooks/commit-msg
   chmod +x .git/hooks/pre-push
   ```

4. **On Windows:** Hooks should work automatically if Git Bash or WSL is available

### Bypass Hooks (Emergency Only)

```bash
# Skip pre-commit checks
git commit --no-verify

# Skip pre-push checks
git push --no-verify
```

**‚ö†Ô∏è Warning:** Only use `--no-verify` in emergency situations. Always fix the underlying issues.

### Common Issues

**"npx not found":**

- Ensure Node.js and npm are installed
- Add npm to your PATH environment variable

**"lint-staged not found":**

- Install lint-staged: `npm install --save-dev lint-staged`
- Configure lint-staged in `package.json`

**Build failures:**

- Ensure `npm run build` script exists
- Fix any TypeScript or build errors

**Platform-specific issues:**

- On Windows: Ensure Git Bash or WSL is available for shell script execution
- On Unix systems: Ensure hooks have executable permissions (`chmod +x`)
- Script compatibility: Some shell commands may behave differently across platforms

## Why Both Husky and Native Hooks?

This project uses **both** systems for different purposes:

**Husky** - Better for:

- üë• Team development (shared configuration)
- üîÑ Easy setup and maintenance
- üéØ Consistent cross-platform behavior

**Native Hooks** - Better for:

- üöÄ Performance and reliability
- üîß Advanced Git integration
- üèóÔ∏è CI/CD environments
- üéØ Production deployments

## Compatibility

- ‚úÖ Works alongside existing Husky setup
- ‚úÖ Compatible with all Git clients (VS Code, GitKraken, command line, etc.)
- ‚úÖ No additional dependencies beyond Node.js ecosystem
- ‚úÖ Follows AI content tracking standards
- ‚ö†Ô∏è Cross-platform compatibility depends on shell script support

## Further Reading

- **[Official Git Hooks Documentation](https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks)** - Complete guide to Git hooks
- **[Git Hooks Tutorial](https://www.atlassian.com/git/tutorials/git-hooks)** - Practical examples and use cases
- **[Husky Documentation](https://typicode.github.io/husky/)** - Alternative hook management tool
