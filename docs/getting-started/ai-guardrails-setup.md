# AI Guardrails for Tech Projects

<!-- [AI-Generated-Copilot] - AI guardrails system documentation and setup -->

A comprehensive system for managing and auditing AI-assisted development in the the tech project.

## ğŸ¯ Overview

The AI Guardrails system provides:

- **ğŸ¤– AI Content Detection** - Automatic identification of AI-generated code
- **ğŸ›¡ï¸ File Restriction System** - Prevents AI from modifying sensitive files
- **ğŸ“ Commit Transformation** - Automatic formatting of AI-assisted commits
- **ğŸ“Š Audit Trail** - Complete logging of AI interactions
- **âš¡ Dual Hook System** - Both Husky and native Git hook implementations

## ğŸš€ Quick Start

### Option 1: Native Git Hooks (Recommended for Production)

1. **Copy hooks to your project:**

   ```bash
   cp tools/git-hooks/native/* /path/to/your/project/.git/hooks/
   chmod +x /path/to/your/project/.git/hooks/*  # Linux/Mac only
   ```

2. **Configure restricted files:**

   ```bash
   cp examples/.ai-restricted-files /path/to/your/project/
   ```

3. **Test the system:**
   ```bash
   # Add AI-generated code with proper comments
   git add file-with-ai-comments.ts
   git commit -m "feat: add new feature"
   # Should auto-transform to AI-assisted format
   ```

### Option 2: Husky Integration

1. **Install Husky (if not already installed):**

   ```bash
   npm install --save-dev husky
   npx husky install
   ```

2. **Copy Husky hooks:**

   ```bash
   cp tools/git-hooks/husky/* .husky/
   ```

3. **Configure and test as above**

## ğŸ“ System Components

```
tools/git-hooks/
â”œâ”€â”€ git-hooks/
â”‚   â”œâ”€â”€ native/           # Native Git hooks
â”‚   â”‚   â”œâ”€â”€ pre-commit    # AI restriction + lint-staged
â”‚   â”‚   â”œâ”€â”€ commit-msg    # Commit message transformation
â”‚   â”‚   â””â”€â”€ pre-push      # Type checking + build verification
â”‚   â””â”€â”€ husky/            # Husky hook implementations
â”‚       â”œâ”€â”€ pre-commit    # Same functionality, Husky format
â”‚       â””â”€â”€ commit-msg    # Enhanced with colored output
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ pre-commit-ai-usage.sh    # AI detection and logging
â”‚   â””â”€â”€ pre-commit-format.sh      # Code formatting
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ .agentrc.yml             # Agent configuration
â”‚   â”œâ”€â”€ .copilotignore           # AI access restrictions
â”‚   â””â”€â”€ vscode/                  # VS Code settings
â””â”€â”€ README.md            # Tools documentation
```

## ğŸ”§ How It Works

### 1. AI Content Detection

The system scans staged files for AI-generated comment patterns:

```typescript
// [AI-Generated-Copilot] - Function to calculate KPI scores
function calculateScore(value: number, target: number): number {
  return Math.round((value / target) * 100)
}
```

**Supported AI Tools:**

- `[AI-Generated-Copilot]` - GitHub Copilot
- `[AI-Generated-Claude]` - Anthropic Claude
- `[AI-Generated-ChatGPT]` - OpenAI ChatGPT
- `[AI-Generated-Gemini]` - Google Gemini
- `[AI-Generated-Other]` - Any other AI tool

### 2. File Restriction Enforcement

Configure restricted files in `.ai-restricted-files`:

```bash
# Security-sensitive files that AI should not modify
**/security/**
**/auth/**
**/.env*
**/package.json
**/Dockerfile
ai-restricted-file.txt
```

When AI touches these files, users get prompted:

```bash
âš ï¸  ğŸš¨ AI RESTRICTION VIOLATION DETECTED ğŸš¨

ğŸ¤– AI tools have modified the following RESTRICTED files:
  âŒ ai-restricted-file.txt
  âŒ src/auth/login.ts

What would you like to do?
  [c] Continue with commit (I take responsibility)
  [a] Abort commit and review changes
  [r] Remove AI comments and continue

Choose [c/a/r]:
```

### 3. Automatic Commit Transformation

**Input:**

```bash
git commit -m "feat(dashboard): add KPI filter"
```

**Output (when AI content detected):**

```
[AI-ASSISTED] feat(dashboard): add KPI filter

Generated by: GitHub Copilot
Reviewed by: John Doe
Scope: Dashboard Components

Original commit message: feat(dashboard): add KPI filter
AI-generated code found in: src/components/kpi-filter.tsx
```

### 4. Comprehensive Audit Trail

**AI Commit Log (`.ai-commit-log`):**

```
2024-01-15 10:30:45 | abc123 | [AI-ASSISTED] feat(utils): add helpers | GitHub Copilot | john.doe
2024-01-15 14:22:18 | def456 | [AI-ASSISTED] docs: update API docs | Claude | jane.smith
```

**Restriction Override Log (`.ai-restriction-log`):**

```
2024-01-15 09:15:30 - AI restriction override by john.doe
Files: src/auth/login.ts
Decision: User chose to continue despite AI restriction
```

## ğŸ“‹ Usage Examples

### Standard AI-Assisted Development

```bash
# 1. Write code with AI assistance and add proper comments
# [AI-Generated-Copilot] - Email validation utility
export function isValidEmail(email: string): boolean {
  // AI-generated implementation
}

# 2. Stage and commit normally
git add src/utils/validation.ts
git commit -m "feat(utils): add email validation"

# 3. System automatically:
#    - Detects AI content
#    - Transforms commit message
#    - Logs for audit trail
```

### Handling Restricted Files

```bash
# 1. AI modifies a restricted file
# File: ai-restricted-file.txt contains [AI-Generated-Copilot] comment

# 2. Attempt to commit
git add ai-restricted-file.txt
git commit -m "update restricted file"

# 3. System prompts for decision
# User chooses [c] to continue

# 4. Override decision logged
# Commit proceeds with AI-assisted format
```

### Multiple AI Tools in One Commit

```bash
# Files contain different AI tool comments:
# - file1.ts: [AI-Generated-Copilot]
# - file2.ts: [AI-Generated-Claude]

git add file1.ts file2.ts
git commit -m "feat: add multiple utilities"

# Primary tool (first detected) used in commit message
# All tools and files listed in commit body
```

## âš™ï¸ Configuration

### Customize Restricted Files

Edit `.ai-restricted-files` to match your project needs:

```bash
# Add project-specific restrictions
**/payment-processor.ts
**/user-management/**
**/critical-config.json

# Use glob patterns for flexibility
**/*.env*
**/secrets/**
```

### Adjust Hook Behavior

**Native hooks** - Edit files in [`tools/git-hooks/native/`](../../tools/git-hooks/native/):

- `pre-commit` - Modify AI detection patterns or restriction logic
- `commit-msg` - Customize commit message transformation
- `pre-push` - Adjust build/test commands

**Husky hooks** - Edit files in [`tools/git-hooks/husky/`](../../tools/git-hooks/husky/):

- Enhanced with colored output and better user experience
- Same core functionality as native hooks

### Environment-Specific Setup

**Development Environment:**

```bash
# Use Husky for easier team sharing
cp tools/git-hooks/husky/* .husky/
```

**Production/CI Environment:**

```bash
# Use native hooks for reliability
cp tools/git-hooks/native/* .git/hooks/
chmod +x .git/hooks/*
```

## ğŸ” Monitoring and Analytics

### View AI Usage Statistics

```bash
# Count commits by AI tool
grep -c "Copilot" .ai-commit-log
grep -c "Claude" .ai-commit-log
grep -c "ChatGPT" .ai-commit-log

# Recent AI activity
tail -20 .ai-commit-log

# Restriction overrides by developer
grep "john.doe" .ai-restriction-log
```

### Generate Reports

```bash
# AI commits this month
grep "$(date '+%Y-%m')" .ai-commit-log

# Most restricted files
grep -o "Files: [^"]*" .ai-restriction-log | sort | uniq -c

# AI tool usage trends
awk '{print $6}' .ai-commit-log | sort | uniq -c
```

## ğŸ› ï¸ Installation for New Projects

### 1. Copy Core Files

```bash
# Copy the entire tools folder
cp -r tools/ /path/to/new/project/

# Copy restriction configuration and examples
cp examples/.ai-restricted-files /path/to/new/project/
cp -r examples/ /path/to/new/project/
```

### 2. Choose Hook System

**For team projects (recommended):**

```bash
cd /path/to/new/project
npm install --save-dev husky lint-staged
npx husky install
cp tools/git-hooks/husky/* .husky/
```

**For individual/production use:**

```bash
cd /path/to/new/project
cp tools/git-hooks/native/* .git/hooks/
chmod +x .git/hooks/*  # Unix systems only
```

### 3. Configure Dependencies

Ensure your `package.json` includes:

```json
{
  "scripts": {
    "build": "your-build-command",
    "test": "your-test-command"
  },
  "lint-staged": {
    "*.{ts,tsx,js,jsx}": ["eslint --fix", "prettier --write"],
    "*.{md,json}": ["prettier --write"]
  }
}
```

### 4. Test Installation

```bash
# Create test file with AI comment
echo '// [AI-Generated-Copilot] - test function\nfunction test() {}' > test-ai.ts

# Test the system
git add test-ai.ts
git commit -m "test: verify AI guardrails"

# Should transform to AI-assisted format
git log -1 --pretty=format:"%s"
```

## ğŸ”§ Troubleshooting

### Common Issues

**Hooks not running:**

```bash
# Check if hooks exist and are executable
ls -la .git/hooks/
# On Unix: chmod +x .git/hooks/*

# Check Git hooks path (should be empty for native hooks)
git config core.hooksPath
# If set to .husky/, unset it: git config --unset core.hooksPath
```

**AI content not detected:**

```bash
# Verify comment format exactly matches
// [AI-Generated-Copilot] - description  # âœ… Correct
//[AI-Generated-Copilot] - description   # âŒ Missing space
```

**Restriction patterns not working:**

```bash
# Check for trailing spaces in .ai-restricted-files
# Test pattern manually:
case "your/file/path" in
  your/pattern) echo "MATCH" ;;
  *) echo "NO MATCH" ;;
esac
```

### Debug Mode

Add debug output to hooks temporarily:

```bash
# In pre-commit hook, add:
echo "DEBUG: Testing file $file against pattern $pattern" >&2
```

### Emergency Bypass

Only use in genuine emergencies:

```bash
# Bypass all hooks
git commit --no-verify -m "emergency: critical fix"

# Temporarily disable restrictions
mv .ai-restricted-files .ai-restricted-files.backup
# Make commit, then restore:
mv .ai-restricted-files.backup .ai-restricted-files
```

## ğŸ“š Documentation

- **[AI Commit Standards](../api/ai-commit-standards.md)** - Complete guide to AI commit formatting
- **[File Restrictions](../api/ai-file-restrictions.md)** - Detailed restriction system documentation
- **[GitHub Copilot Instructions](../../.github/instructions/ai-commit-guide.instructions.md)** - AI instruction file for GitHub Copilot integration

## ğŸ¤ Contributing

When contributing to the AI Guardrails system:

1. **Test thoroughly** on different platforms (Windows/Mac/Linux)
2. **Update documentation** for any changes
3. **Maintain backwards compatibility** when possible
4. **Follow existing patterns** for consistency
5. **Add AI comments** to new AI-generated code

## ğŸ“„ License

This AI Guardrails system is part of the KPI Manager Pro project (Test project created by Rajesh) and follows the same license terms.

---

**ğŸš€ Ready to get started?** Choose your hook system and follow the Quick Start guide above!
